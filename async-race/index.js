(()=>{"use strict";const t=t=>{if(!(t&&t instanceof HTMLElement))throw new TypeError;return t},e=e=>s=>t(e.querySelector(s));function s(t){return t[0].toUpperCase()+t.slice(1)}function n(t){return Object.entries(t).map((t=>t.join("="))).join("&")}async function r(t){try{return await t}catch(t){return t}}class a{constructor(t){const{root:e,component:s}=t;this.component=s,this.root=e||null,this._root=null}getRoot(){return null===this._root?"string"!=typeof this.root?t(this.root):e(document)(this.root):this._root}afterRender(t,s=-1){if("string"==typeof this.root){if(-1===s&&null!==t)this._root=e(t.getRoot())(this.root);else if(null!==t){const e=t.getRoot().querySelectorAll(this.root)[s];e instanceof HTMLElement&&(this._root=e)}}else this._root=this.root}renderChild(...t){return this.component.renderChild(...t)}render(t){return void 0!==t&&"string"==typeof t?t:""}}class i extends a{constructor(t){super({...t,root:".lds-dual-ring"})}render(){return super.render('\n      <div class="lds-dual-ring"></div>\n    ')}}class o extends a{constructor(t){super(t),this.isLoading=!1}render(t){const e=this.isLoading?this.renderChild("spinner",h,{viewConstructor:i}):"string"==typeof t?t:"";return"function"==typeof t?t(e):e}}function c(t,{data:e,forceLog:s=!1}={}){s&&console.log(`%c${t}`,"color: blue;",Object.getPrototypeOf(this).constructor.name,this.viewConstructor?.name,e||"")}class h extends class{constructor(t){this.emmiter=t,this.listenersForRemove=[]}emit(t,e){this.emmiter?.emit(t,e)}on(t,e){this.emmiter&&this.listenersForRemove.push(this.emmiter.on(t,e))}}{constructor(t){if(super(t.emmiter),this.name=t.name||"",this.id=-1,this.parent=t.parent||null,this._components={},this.handlers=t.handlers||{},this.viewConstructor=t.viewConstructor||a,this.viewConstructor.name===a.prototype.constructor.name&&void 0===t.viewOptions?.root)throw new Error(`You should specify root for component (${this.constructor.name}) with no view`);this.view=new this.viewConstructor({...t.viewOptions,component:this}),c.call(this,"COMPONENT CONSTRUCTING END")}renderChild(...[t,e,s={}]){c.call(this,"COMPONENT ADD CHILD:",{data:`'${t}'[${e.name}]`});const n=new e({...s,name:t,parent:this,emmiter:this.emmiter}),r=this._components[t];return void 0!==r?Array.isArray(r)?(n.id=r.length,r.push(n)):(r.id=0,n.id=1,this._components[t]=[r,n]):this._components[t]=n,n.render(s.viewOptions?.data)}isArrayItem(){return-1!==this.id}remove(){this.parent?.removeChild(this)}update(t){this.parent?.updateChild(this,t)}removeChild(t){t.onDestroy();const e=this._components[t.name];if(Array.isArray(e)){const s=e.filter((e=>e.getId()!==t.getId()));s.forEach(((t,e)=>t.setId(e))),1===s.length&&(this._components[t.name]=s[0])}else delete this._components[t.name];const s=t.getRoot();s.parentNode?.removeChild(s)}updateChild(t,e){c.call(this,"UPDATING",{data:`CHILD: ${t.name}`});const s=t.getRoot(),n=t.render(e);if(t.view.constructor.name===a.prototype.constructor.name){const t=s.cloneNode();t.innerHTML=n,s.after(t)}else s.insertAdjacentHTML("afterend",n);s.parentNode?.removeChild(s),t.afterRender()}getChild(t){return this._components[t]}getId(){return this.id}setId(t){this.id=t}getComponent(t){return this._components[t]}getComponents(){return this._components}getRoot(){return this.view.getRoot()}onLoadingStart(){this.view instanceof o&&(this.view.isLoading=!0)}onLoadingEnd(t){this.view instanceof o&&(this.view.isLoading=!1),this.update(t)}render(t){return c.call(this,"COMPONENT RENDER: "),Object.keys(this._components).length>0&&this.removeChildrens(),this.view.render(t)}afterRender(){c.call(this,"COMPONENT AFTER RENDER",{data:this.parent?.getRoot()}),this.view.afterRender(this.parent,this.id),Object.keys(this._components).forEach((t=>{const e=this._components[t];Array.isArray(e)?e.forEach((t=>t.afterRender())):e.afterRender()}))}removeChildrens(){Object.keys(this._components).forEach((t=>{const e=this._components[t];Array.isArray(e)?e.forEach((t=>t.onDestroy())):e.onDestroy()})),this._components={}}onDestroy(){this.listenersForRemove.forEach((t=>t.call(null))),this.removeChildrens()}}class l extends a{constructor(t){super({...t,root:".rsschool-logo"})}render(){return super.render('\n      <a class="rsschool-logo" href="https://rs.school/js/" title="https://rs.school/js/" target="_blank">\n        <svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 552.8 205.3">\n          <style>.st0{fill:var( --text-color-1)}.st1{clip-path:url(#SVGID_2_)}.st2{clip-path:url(#SVGID_4_)}.st3{clip-path:url(#SVGID_6_)}.st4{clip-path:url(#SVGID_8_)}.st5{fill:var(--text-color-1);stroke-width:4;stroke-miterlimit:10}.st6{clip-path:url(#SVGID_8_)}.st6,.st7{fill:none;stroke-width:4;stroke-miterlimit:10}.st8,.st9{clip-path:url(#SVGID_10_)}.st9{fill:none;stroke-width:4;stroke-miterlimit:10}</style>\n          <title>rs_school_js</title>\n          <path class="logo-path" d="M285.4 68l26.3-1.7c.6 4.3 1.7 7.5 3.5 9.8 2.9 3.6 6.9 5.4 12.2 5.4 3.9 0 7-.9 9.1-2.8 2-1.5 3.2-3.9 3.2-6.4 0-2.4-1.1-4.7-3-6.2-2-1.8-6.7-3.6-14.1-5.2-12.1-2.7-20.8-6.3-25.9-10.9-5.1-4.3-8-10.6-7.8-17.3 0-4.6 1.4-9.2 4-13 3-4.3 7.1-7.7 12-9.6 5.3-2.3 12.7-3.5 22-3.5 11.4 0 20.1 2.1 26.1 6.4 6 4.2 9.6 11 10.7 20.3l-26 1.5c-.7-4-2.1-6.9-4.4-8.8s-5.3-2.8-9.2-2.8c-3.2 0-5.6.7-7.2 2-1.5 1.2-2.5 3-2.4 5 0 1.5.8 2.9 2 3.8 1.3 1.2 4.4 2.3 9.3 3.3 12.1 2.6 20.7 5.2 26 7.9 5.3 2.7 9.1 6 11.4 9.9 2.4 4 3.6 8.6 3.5 13.3 0 5.6-1.6 11.2-4.8 15.9-3.3 4.9-7.9 8.7-13.3 11-5.7 2.5-12.9 3.8-21.5 3.8-15.2 0-25.7-2.9-31.6-8.8S286.1 77 285.4 68zM6.3 97.6V8.2h46.1c8.5 0 15.1.7 19.6 2.2 4.4 1.4 8.3 4.3 10.9 8.2 2.9 4.3 4.3 9.3 4.2 14.5.3 8.8-4.2 17.2-11.9 21.6-3 1.7-6.3 2.9-9.7 3.5 2.5.7 5 1.9 7.2 3.3 1.7 1.4 3.1 3 4.4 4.7 1.5 1.7 2.8 3.6 3.9 5.6l13.4 25.9H63L48.2 70.2c-1.9-3.5-3.5-5.8-5-6.9-2-1.4-4.4-2.1-6.8-2.1H34v36.3H6.3zM34 44.4h11.7c2.5-.2 4.9-.6 7.3-1.2 1.8-.3 3.4-1.3 4.5-2.8 2.7-3.6 2.3-8.7-1-11.8-1.8-1.5-5.3-2.3-10.3-2.3H34v18.1zM0 174.2l26.3-1.7c.6 4.3 1.7 7.5 3.5 9.8 2.8 3.6 6.9 5.5 12.2 5.5 3.9 0 7-.9 9.1-2.8 2-1.6 3.2-3.9 3.2-6.4 0-2.4-1.1-4.7-3-6.2-2-1.8-6.7-3.6-14.2-5.2-12.1-2.7-20.8-6.3-25.9-10.9-5.1-4.3-8-10.6-7.8-17.3 0-4.6 1.4-9.2 4-13 3-4.3 7.1-7.7 12-9.6 5.3-2.3 12.7-3.5 22-3.5 11.4 0 20.1 2.1 26.1 6.4s9.5 11 10.6 20.3l-26 1.5c-.7-4-2.1-6.9-4.4-8.8-2.2-1.9-5.3-2.8-9.2-2.7-3.2 0-5.6.7-7.2 2.1-1.6 1.2-2.5 3-2.4 5 0 1.5.8 2.9 2 3.8 1.3 1.2 4.4 2.3 9.3 3.3 12.1 2.6 20.7 5.2 26 7.9 5.3 2.7 9.1 6 11.4 9.9 2.4 4 3.6 8.6 3.6 13.2 0 5.6-1.7 11.1-4.8 15.8-3.3 4.9-7.9 8.7-13.3 11-5.7 2.5-12.9 3.8-21.5 3.8-15.2 0-25.7-2.9-31.6-8.8-5.9-6-9.2-13.4-10-22.4z"/>\n          <path class="logo-path" d="M133 167.2l24.2 7.3c-1.3 6.1-4 11.9-7.7 17-3.4 4.5-7.9 8-13 10.3-5.2 2.3-11.8 3.5-19.8 3.5-9.7 0-17.7-1.4-23.8-4.2-6.2-2.8-11.5-7.8-16-14.9-4.5-7.1-6.7-16.2-6.7-27.3 0-14.8 3.9-26.2 11.8-34.1s19-11.9 33.4-11.9c11.3 0 20.1 2.3 26.6 6.8 6.4 4.6 11.2 11.6 14.4 21l-24.4 5.4c-.6-2.1-1.5-4.2-2.7-6-1.5-2.1-3.4-3.7-5.7-4.9-2.3-1.2-4.9-1.7-7.5-1.7-6.3 0-11.1 2.5-14.4 7.6-2.5 3.7-3.8 9.6-3.8 17.6 0 9.9 1.5 16.7 4.5 20.4 3 3.7 7.2 5.5 12.7 5.5 5.3 0 9.3-1.5 12-4.4 2.7-3.1 4.7-7.4 5.9-13zm56.5-52.8h27.6v31.3h30.2v-31.3h27.8v89.4h-27.8v-36.2h-30.2v36.2h-27.6v-89.4z"/>\n          <path class="logo-path" d="M271.3 159.1c0-14.6 4.1-26 12.2-34.1 8.1-8.1 19.5-12.2 34-12.2 14.9 0 26.3 4 34.4 12S364 144 364 158.4c0 10.5-1.8 19-5.3 25.7-3.4 6.6-8.7 12-15.2 15.6-6.7 3.7-15 5.6-24.9 5.6-10.1 0-18.4-1.6-25-4.8-6.8-3.4-12.4-8.7-16.1-15.2-4.1-7-6.2-15.7-6.2-26.2zm27.6.1c0 9 1.7 15.5 5 19.5 3.3 3.9 7.9 5.9 13.7 5.9 5.9 0 10.5-1.9 13.8-5.8s4.9-10.8 4.9-20.8c0-8.4-1.7-14.6-5.1-18.4-3.4-3.9-8-5.8-13.8-5.8-5.1-.2-10 2-13.4 5.9-3.4 3.9-5.1 10.4-5.1 19.5zm93.4-.1c0-14.6 4.1-26 12.2-34.1 8.1-8.1 19.5-12.2 34-12.2 14.9 0 26.4 4 34.4 12S485 144 485 158.4c0 10.5-1.8 19-5.3 25.7-3.4 6.6-8.7 12-15.2 15.6-6.7 3.7-15 5.6-24.9 5.6-10.1 0-18.4-1.6-25-4.8-6.8-3.4-12.4-8.7-16.1-15.2-4.1-7-6.2-15.7-6.2-26.2zm27.6.1c0 9 1.7 15.5 5 19.5 3.3 3.9 7.9 5.9 13.7 5.9 5.9 0 10.5-1.9 13.8-5.8 3.3-3.9 4.9-10.8 4.9-20.8 0-8.4-1.7-14.6-5.1-18.4-3.4-3.9-8-5.8-13.8-5.8-5.1-.2-10.1 2-13.4 5.9-3.4 3.9-5.1 10.4-5.1 19.5z"/>\n          <path class="logo-path" d="M482.1 114.4h27.6v67.4h43.1v22H482v-89.4z"/>\n          <ellipse transform="rotate(-37.001 420.46 67.88)" class="st0" cx="420.5" cy="67.9" rx="63" ry="51.8"/><defs><ellipse id="SVGID_1_" class="st0" transform="rotate(-37.001 420.46 67.88)" cx="420.5" cy="67.9" rx="63" ry="51.8"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" overflow="visible"/></clipPath><g class="st1"><path transform="rotate(-37.001 420.82 68.353)" class="st0" d="M330.9-14.2h179.8v165.1H330.9z"/><g id="Layer_2_1_"><defs><path id="SVGID_3_" transform="rotate(-37.001 420.82 68.353)" d="M330.9-14.2h179.8v165.1H330.9z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" overflow="visible"/></clipPath><g id="Layer_1-2" class="st2"><ellipse transform="rotate(-37.001 420.46 67.88)" class="st0" cx="420.5" cy="67.9" rx="63" ry="51.8"/><defs><ellipse id="SVGID_5_" transform="rotate(-37.001 420.46 67.88)" cx="420.5" cy="67.9" rx="63" ry="51.8"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" overflow="visible"/></clipPath><g class="st3"><path transform="rotate(-37 420.799 68.802)" class="st0" d="M357.8 17h125.9v103.7H357.8z"/><defs><path id="SVGID_7_" transform="rotate(-37 420.799 68.802)" d="M357.8 17h125.9v103.7H357.8z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" overflow="visible"/></clipPath><g class="st4"><ellipse transform="rotate(-37.001 420.46 67.88)" class="st5" cx="420.5" cy="67.9" rx="63" ry="51.8"/></g><path transform="rotate(-37 420.799 68.802)" class="st6" d="M357.8 17h125.9v103.7H357.8z"/><ellipse transform="rotate(-37.001 420.46 67.88)" class="st7" cx="420.5" cy="67.9" rx="63" ry="51.8"/><path transform="rotate(-37 420.799 68.802)" class="st0" d="M357.8 17h125.9v103.7H357.8z"/><defs><path id="SVGID_9_" transform="rotate(-37 420.799 68.802)" d="M357.8 17h125.9v103.7H357.8z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" overflow="visible"/></clipPath><g class="st8"><ellipse transform="rotate(-37.001 420.46 67.88)" class="st5" cx="420.5" cy="67.9" rx="63" ry="51.8"/></g><path transform="rotate(-37 420.799 68.802)" class="st9" d="M357.8 17h125.9v103.7H357.8z"/><path transform="rotate(-37.001 420.82 68.353)" class="st7" d="M330.9-14.2h179.8v165.1H330.9z"/></g><ellipse transform="rotate(-37.001 420.46 67.88)" class="st7" cx="420.5" cy="67.9" rx="63" ry="51.8"/>\n          <path class="st1" d="M392.4 61.3l10-7 12.3 17.5c2.1 2.8 3.7 5.8 4.9 9.1.7 2.5.5 5.2-.5 7.6-1.3 3-3.4 5.5-6.2 7.3-3.3 2.3-6.1 3.6-8.5 4-2.3.4-4.7 0-6.9-1-2.4-1.2-4.5-2.9-6.1-5.1l8.6-8c.7 1.1 1.6 2.1 2.6 2.9.7.5 1.5.8 2.4.8.7 0 1.4-.3 1.9-.7 1-.6 1.7-1.8 1.6-3-.3-1.7-1-3.4-2.1-4.7l-14-19.7zm30 11.1l9.1-7.2c1 1.2 2.3 2.1 3.7 2.6 2 .6 4.1.2 5.8-1.1 1.2-.8 2.2-1.9 2.6-3.3.6-1.8-.4-3.8-2.2-4.4-.3-.1-.6-.2-.9-.2-1.2-.1-3.3.4-6.4 1.7-5.1 2.1-9.1 2.9-12.1 2.6-2.9-.3-5.6-1.8-7.2-4.3-1.2-1.7-1.8-3.7-1.9-5.7 0-2.3.6-4.6 1.9-6.5 1.9-2.7 4.2-5 7-6.8 4.2-2.9 7.9-4.3 11.1-4.3 3.2 0 6.2 1.5 9 4.6l-9 7.1c-1.8-2.3-5.2-2.8-7.5-1l-.3.3c-1 .6-1.7 1.5-2.1 2.6-.3.8-.1 1.7.4 2.4.4.5 1 .9 1.7.9.8.1 2.2-.3 4.2-1.2 5-2.1 8.8-3.3 11.4-3.7 2.2-.4 4.5-.2 6.6.7 1.9.8 3.5 2.2 4.6 3.9 1.4 2 2.2 4.4 2.3 6.9.1 2.6-.6 5.1-2 7.3-1.8 2.7-4.1 5-6.8 6.8-5.5 3.8-10 5.4-13.6 4.8-3.9-.6-7.1-2.6-9.4-5.5z"/></g></g></g>\n        </svg>\n      </a>\n    ')}}class d extends a{constructor(t){super({...t,root:".footer"})}render(){return super.render(`\n      <div class="footer">\n        <div class="footer__container container">\n          ${this.renderChild("rssLogo",h,{viewConstructor:l})}\n          <div class="footer__year">\n            2022\n          </div>\n          <a class="footer__github-link" href="https://github.com/tretyakov-a" title="GitHub" target="_blank">\n            <i class="fab fa-github"></i>\n            tretyakov-a\n          </a>\n        </div>\n      </div>\n    `)}}class u{static getPath(){const t=window.location.hash.split("?")[0];return""===t?"#":t}static getQueryParams(){const[t,e]=window.location.hash.split("?");let s={};return void 0!==e&&""!==e&&(s=e.split("&").map((t=>t.split("="))).reduce(((t,[e,s])=>(t[e]=s,t)),{})),s}static change(t){const{origin:e,pathname:s}=window.location,n=new URL(`${e}${s}#${t}`);window.history.pushState({},"",n),window.dispatchEvent(new HashChangeEvent("hashchange"))}}class p extends a{constructor(t){super({...t,root:".header"})}renderMenu(t){const e=u.getPath();return`\n      <ul class="header-menu">\n        ${Object.keys(t).map((s=>`\n      <li class="header-menu__item ${s===e?"header-menu__item_active":""}">\n        <a href="${s}">${t[s].content}</a>\n      </li>\n    `)).join("")}\n      </ul>`}render(){return super.render(`\n      <div class="header">\n        <div class="header__container container">\n          <a class="header__logo logo" href="#">\n            <h1>🏁 Async Race</h1>\n          </a>\n          <nav class="header__menu">\n            ${this.renderMenu({"#":{content:"Garage"},"#winners":{content:"Winners"}})}\n          </nav>\n        </div>\n      </div>\n    `)}}const m="http://localhost:3000",g={name:"",color:"#000000"};var v,C;!function(t){t.LOAD_APP="onAppLoad",t.SHOW_ALERT="onShowAlert",t.ROUTER_CHANGE_PAGE="onChangePage",t.CARS_AFTER_RENDER="onRenderCars",t.TRY_CREATE_CAR="onCreateCar",t.TRY_UPDATE_CAR="onUpdateCar",t.SELECT_CAR="onSelectCar",t.TRY_REMOVE_CAR="onTryRemoveCar",t.REMOVE_CAR="onRemoveCar",t.START_CAR_ENGINE="onStartCarEngine",t.ACCELERATE_CAR="onAccelerateCar",t.BREAK_CAR="onBreakCar",t.START_RACE="onStartRace",t.RESET_CARS="onResetCars",t.RACE_END="onRaceEnd",t.GARAGE_CHANGE_PAGE="onGarageChangePage",t.WINNERS_CHANGE_PAGE="onWinnersChangePage",t.GENERATE_CARS="onGenerateCars",t.LOAD_WINNERS="onLoadWinners",t.GET_WINNERS="onGetWinners",t.UPDATE_CAR_FORM_DATA="onUpdateCarFrom"}(v||(v={})),function(t){t[t.GARAGE=7]="GARAGE",t[t.WINNERS=10]="WINNERS"}(C||(C={}));const _=["Alfa Romeo","Aston Martin","Audi","Bentley","BMW","Land Rover","Lexus","Mercedes-Benz","Nissan","Opel","Porsche","Tesla","Toyota","Volkswagen","Volvo"],E=["Model S","Model 3","Model X","Model Y","X1","X2","X3","X4","W222","C217"];class R extends a{constructor(t){super({...t,root:".alert"})}render(t){return super.render(`\n      <div class="alert">\n        <p>${t?t.message:""}</p>\n      </div>\n    `)}}class f extends h{constructor(t){super({...t,viewConstructor:R}),this.handleShowAlert=t=>{const e=t.detail;this.update({message:e}),this.getRoot().classList.remove("alert_hide"),this.getRoot().classList.add("alert_show"),setTimeout((()=>{this.getRoot().classList.remove("alert_show"),this.getRoot().classList.add("alert_hide")}),f.hideDelay)},this.on(v.SHOW_ALERT,this.handleShowAlert)}}f.hideDelay=3e3;class w extends a{constructor(t){super({...t,root:".page-not-found"})}render(){return super.render('\n      <div class="page-not-found">\n        <div class="page-not-found__container container">\n          <p>404. Page not found!</p>\n          <a href="#">Back to main page</a>\n        </div>\n      </div>\n    ')}}class A extends h{constructor(t){super(t),this.handlePageChange=()=>{const t=this.getRouteData();window.scrollTo({top:0}),this.update(t),this.emit(v.ROUTER_CHANGE_PAGE,{activePage:t[0]})},this.routes=t.data.routes,window.addEventListener("hashchange",this.handlePageChange)}getRouteData(){let t=u.getPath();return"#not-found"===t||void 0===this.routes[t]?["notFoundPage",h,{viewConstructor:w}]:this.routes[t]}render(t){super.render();let e=t;return void 0===e&&(e=this.getRouteData()),"string"==typeof e?e:this.renderChild(...e)}}class y extends a{constructor(t){super({...t,root:t.root||".button"})}render(t){return void 0===t?"":super.render(`\n      <button class="${t.classes||""}">${t.content}</button>\n    `)}}class b extends h{constructor(t){super({...t,viewConstructor:y}),this.onClick=t=>{this.handlers.onClick&&this.handlers.onClick(t)}}afterRender(){super.afterRender(),this.getRoot().addEventListener("click",this.onClick)}enable(){this.getRoot().classList.remove("button_disabled")}disable(){this.getRoot().classList.add("button_disabled")}getIcon(){const t=this.getComponent("icon");if(void 0!==t&&!Array.isArray(t))return t}}class D extends a{constructor(t){super({...t,root:".loading-overlay"})}render(){return super.render(`\n      <div class="loading-overlay">\n        ${this.renderChild("spinner",h,{viewConstructor:i})}\n      </div>\n    `)}}class T extends a{render(t){if(void 0===t)return"";const{handleClick:e,buttonContent:s,carName:n,color:r}=t;return super.render(`\n      <div class="control-panel__${s.toLowerCase()}-car create-car">\n        ${this.renderChild("overlay",h,{viewConstructor:D})}\n        \n        <input type="text" class="create-car__input text" placeholder="Car model" value="${n}">\n        <input type="color" class="create-car__color-pick" value="${r}">\n        ${this.renderChild("button",b,{handlers:{onClick:e},viewOptions:{data:{content:s,classes:"create-car__submit button"}}})}\n      </div>\n    `)}}class S extends h{constructor(t){super(t),this.showOverlay=()=>{null!==this.overlay&&(this.overlay.getRoot().classList.add("loading-overlay_show"),this.getRoot().style.pointerEvents="none")},this.hideOverlay=()=>{null!==this.overlay&&(this.overlay.getRoot().classList.remove("loading-overlay_show"),this.getRoot().style.pointerEvents="all")},this.overlay=null}afterRender(){super.afterRender();const t=this.getComponent("overlay");Array.isArray(t)||(this.overlay=t)}}class P extends S{constructor(t){super({...t,viewConstructor:T}),this.handleAppLoad=t=>{const{selectedCarId:e,createCarData:s,updateCarData:n}=t.detail,r="Create"===this.buttonContent?s:n;null!==this.inputEl&&(this.inputEl.value=r.name),null!==this.colorPickEl&&(this.colorPickEl.value=r.color),null!==e&&this.isUpdateForm()&&this.button?.enable(),this.handleInput()},this.handleClick=t=>{const{carName:e,color:s}=this;if(""===e||e.length<3)return this.emit(v.SHOW_ALERT,"Car name length should be >= 3");this.showOverlay(),this.emit(this.buttonClickEvent,{carData:{name:e,color:s},onComplete:()=>{this.setDefault(),this.hideOverlay(),this.isUpdateForm()&&this.button?.disable(),this.updateAppData()}})},this.handleInput=()=>{null!==this.inputEl&&(this.carName=this.inputEl.value),null!==this.colorPickEl&&(this.color=this.colorPickEl.value),this.updateAppData()},this.handleSelect=t=>{const{name:e,color:s}=t.detail.car;null!==this.inputEl&&(this.inputEl.value=e),null!==this.colorPickEl&&(this.colorPickEl.value=s),this.handleInput(),this.update(this),this.isUpdateForm()&&this.button?.enable()};const{data:e}=t;if(void 0===e)throw new TypeError;this.inputEl=null,this.colorPickEl=null,this.carName=e.carName||g.name,this.color=e.color||g.color,this.buttonContent=e.buttonContent,this.buttonClickEvent=e.buttonClickEvent,this.button=null,this.isUpdateForm()&&this.on(v.SELECT_CAR,this.handleSelect),this.on(v.LOAD_APP,this.handleAppLoad)}render(){return super.render(this)}isUpdateForm(){return this.buttonClickEvent===v.TRY_UPDATE_CAR}setDefault(){this.carName=g.name,this.color=g.color,this.inputEl&&(this.inputEl.value=this.carName),this.colorPickEl&&(this.colorPickEl.value=this.color)}updateAppData(){this.emit(v.UPDATE_CAR_FORM_DATA,{form:this.buttonContent,data:{name:this.carName,color:this.color}})}afterRender(){super.afterRender();const t=e(this.getRoot())(".create-car__input");(t instanceof HTMLInputElement||t instanceof HTMLSelectElement)&&(this.inputEl=t,this.inputEl.addEventListener("input",this.handleInput));const s=e(this.getRoot())(".create-car__color-pick");s instanceof HTMLInputElement&&(this.colorPickEl=s,this.colorPickEl.addEventListener("change",this.handleInput));const n=this.getComponent("button");!Array.isArray(n)&&n instanceof b&&(this.button=n,this.isUpdateForm()&&this.button.disable())}}class L extends a{constructor(t){super({...t,root:".paginator"})}render(t){const{prevHandler:e,nextHandler:s,pageNumber:n,maxPage:r,nextClasses:a,prevClasses:i}=t;return super.render(`\n      <div class="paginator">\n        ${I.call(this,"paginator",{prev:{handler:e,classes:i},page:{handler:()=>{},content:`Page ${n}/${r}`,classes:"button_inactive"},next:{handler:s,classes:a}})}\n      </div>\n    `)}}class N extends h{constructor(t){super({...t,viewConstructor:L}),this.handleNextClick=()=>{this.pageNumber+=1,this.pageNumber>this.maxPage&&(this.pageNumber=this.maxPage),this.emit(v[this.eventName],{pageNumber:this.pageNumber})},this.handlePrevClick=()=>{this.pageNumber-=1,0===this.pageNumber&&(this.pageNumber=1),this.emit(v[this.eventName],{pageNumber:this.pageNumber})},this.setButtons=t=>{this.buttons.next[t](),this.buttons.prev[t]()},this.handleStartRace=()=>{this.setButtons("disable")},this.handleEndRace=()=>{this.setButtons("enable"),this.updateButtons()};const{data:e}=t,s=e.pageName.toUpperCase();this.pageNumber=e.pageNumber,this.maxPage=Math.ceil(e.amount/C[s]),this.eventName=`${s}_CHANGE_PAGE`,this.buttons={},this.on(v.START_RACE,this.handleStartRace),this.on(v.RACE_END,this.handleEndRace)}render(){const{handleNextClick:t,handlePrevClick:e,pageNumber:s,maxPage:n}=this;return super.render({prevHandler:e,nextHandler:t,pageNumber:s,maxPage:n,prevClasses:1===this.pageNumber?"button_disabled":"",nextClasses:this.pageNumber===this.maxPage?"button_disabled":""})}afterRender(){super.afterRender(),["next","prev"].forEach((t=>{const e=this.getComponent(t);!Array.isArray(e)&&e instanceof b&&(this.buttons[t]=e)}))}updateButtons(){const t=1===this.pageNumber?"disable":"enable";this.buttons.prev[t]();const e=this.pageNumber===this.maxPage?"disable":"enable";this.buttons.next[e]()}}function I(t,e){return Object.keys(e).map((n=>{const{handler:r,content:a,classes:i}=e[n];return this.renderChild(n,b,{handlers:null!==r?{onClick:r}:{},viewOptions:{root:`.${t}__${n}`,data:{content:a||s(n),classes:`${t}__${n} button ${i||""}`}}})})).join("")}function k(t,e,s){return this.renderChild("paginator",N,{data:{pageNumber:t,amount:e,pageName:s}})}class $ extends a{constructor(t){super({...t,root:".control-panel"})}renderForms(t){return Object.keys(t).map((e=>this.renderChild(e,P,{viewOptions:{root:`.control-panel__${e}-car`},data:{buttonContent:s(e),buttonClickEvent:t[e]}}))).join("")}render(t){const{raceHandler:e,resetHandler:s,generateCarsHandler:n}=t;return super.render(`\n      <div class="garage__control-panel control-panel">\n        ${this.renderChild("overlay",h,{viewConstructor:D})}\n        ${this.renderForms({create:v.TRY_CREATE_CAR,update:v.TRY_UPDATE_CAR})}\n        <div class="control-panel__buttons-group">\n          ${I.call(this,"control-panel",{race:{handler:e},reset:{handler:s},generate:{handler:n}})}\n        </div>\n      </div>\n    `)}}class O extends S{constructor(t){super({...t,viewConstructor:$}),this.handleRaceClick=()=>{this.emit(v.START_RACE),this.showOverlay()},this.handleResetClick=()=>{this.showOverlay(),this.emit(v.RESET_CARS,{onComplete:t=>{this.hideOverlay()}})},this.handleGenerateCarsClick=()=>{this.showOverlay(),this.emit(v.GENERATE_CARS,{onComplete:t=>{this.hideOverlay()}})},this.on(v.RACE_END,this.hideOverlay)}render(){const{handleRaceClick:t,handleResetClick:e,handleGenerateCarsClick:s}=this;return super.render({raceHandler:t,resetHandler:e,generateCarsHandler:s})}}class x extends a{constructor(t){super({...t,root:".car-img"})}render(t){return super.render(`\n      <div class="car__img car-img">\n        <div class="car-img__smoke-container">\n          <div class="car-img__smoke"></div>\n          <div class="car-img__smoke"></div>\n          <div class="car-img__smoke"></div>\n          <div class="car-img__smoke"></div>\n          <div class="car-img__smoke"></div>\n          <div class="car-img__smoke"></div>\n        </div>\n        ${(t=>`\n<?xml version="1.0" standalone="no"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"\n "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">\n<svg version="1.0" xmlns="http://www.w3.org/2000/svg"\n viewBox="0 0 1280.000000 640.000000"\n preserveAspectRatio="xMidYMid meet" fill="#333333">\n<metadata>\nCreated by potrace 1.15, written by Peter Selinger 2001-2017\n</metadata>\n<g transform="translate(0.000000,640.000000) scale(0.100000,-0.100000)">\n<path fill="${t||"#ffffff"}" stroke="#333333" stroke-width="200" d="M3525 5341 c-72 -18 -79 -28 -90 -121 -4 -30 -11 -62 -16 -71 -4 -9\n-97 -51 -206 -94 -774 -304 -1348 -540 -1603 -661 -163 -77 -222 -91 -421\n-104 -85 -5 -170 -14 -189 -20 -101 -32 -362 -58 -620 -63 l-115 -2 -47 -80\nc-47 -78 -47 -80 -29 -100 34 -36 35 -77 5 -177 -30 -99 -34 -178 -19 -370 5\n-67 4 -88 -6 -88 -29 0 -83 -56 -110 -114 -50 -106 -74 -343 -48 -467 13 -58\n13 -62 3 -159 -5 -54 16 -238 28 -244 2 -1 29 -20 61 -41 73 -49 123 -103 132\n-143 17 -79 167 -155 355 -181 104 -15 969 -97 1087 -104 l32 -2 5 160 c7 230\n50 394 146 559 281 479 917 673 1405 429 316 -159 530 -424 598 -742 22 -106\n29 -365 13 -519 l-8 -82 3002 0 c2855 0 3002 1 2995 18 -33 87 -56 325 -45\n461 28 320 177 567 459 759 399 273 847 282 1243 24 239 -157 397 -392 460\n-687 18 -84 15 -341 -5 -430 -8 -38 -14 -71 -12 -73 7 -8 386 20 478 34 180\n28 253 65 304 152 24 41 28 57 28 127 -1 44 -9 117 -20 163 -18 79 -18 88 -2\n190 31 199 40 306 41 497 1 176 -1 195 -23 260 -46 135 -103 190 -283 274\n-222 104 -633 220 -1168 330 -523 108 -1524 210 -2054 211 l-229 0 -236 139\nc-813 477 -1593 884 -1852 966 -498 157 -1598 195 -2892 100 l-188 -14 -47 30\nc-92 58 -223 89 -297 70z m1912 -311 c13 -45 58 -305 88 -515 33 -226 74 -539\n71 -542 -7 -7 -1672 40 -2054 58 -357 16 -464 56 -573 215 -62 91 -87 225 -59\n326 12 40 56 74 192 148 369 198 799 289 1618 340 246 15 290 16 510 16 l194\n-1 13 -45z m649 10 c383 -36 717 -86 934 -139 210 -52 451 -163 720 -332 141\n-88 379 -259 380 -271 0 -5 -14 -8 -32 -8 -48 0 -114 -37 -140 -78 -24 -39\n-30 -113 -15 -189 l9 -43 -904 0 -904 0 -176 540 -175 540 47 0 c25 0 141 -9\n256 -20z"/>\n<path d="M2617 3125 c-431 -82 -774 -440 -838 -875 -17 -117 -7 -292 24 -410\n113 -436 497 -751 947 -777 507 -29 959 313 1076 813 28 117 26 348 -4 467\n-94 378 -383 670 -760 768 -105 27 -336 34 -445 14z m378 -310 c84 -21 209\n-85 280 -142 116 -94 210 -242 251 -393 23 -87 24 -260 0 -355 -58 -237 -242\n-439 -473 -519 -531 -186 -1074 277 -969 828 30 152 94 274 206 386 111 110\n237 178 385 206 84 16 235 11 320 -11z"/>\n<path d="M2918 2568 c2 -90 7 -167 12 -172 17 -17 108 58 201 166 l51 57 -48\n31 c-52 33 -131 65 -185 75 l-34 6 3 -163z"/>\n<path d="M2591 2700 c-62 -22 -167 -82 -164 -94 3 -13 237 -216 249 -216 7 0\n15 7 18 16 8 20 8 127 -1 232 -7 95 -8 96 -102 62z"/>\n<path d="M3209 2355 c-57 -64 -105 -123 -107 -131 -6 -25 46 -35 157 -29 58 3\n121 8 139 11 33 5 34 6 27 42 -7 44 -64 167 -92 201 l-19 24 -105 -118z"/>\n<path d="M2260 2409 c-31 -44 -68 -133 -77 -186 l-6 -33 155 0 c165 0 201 9\n181 44 -13 24 -204 216 -214 216 -5 0 -22 -18 -39 -41z"/>\n<path d="M2786 2354 c-36 -35 0 -87 44 -64 26 14 26 56 1 70 -25 13 -27 13\n-45 -6z"/>\n<path d="M2751 2186 c-57 -32 -68 -111 -22 -157 43 -42 101 -43 143 -1 42 42\n41 100 -1 143 -33 32 -78 38 -120 15z"/>\n<path d="M2560 2136 c-19 -23 -8 -61 18 -64 44 -7 67 32 36 62 -19 20 -38 20\n-54 2z"/>\n<path d="M3002 2124 c-27 -19 -28 -36 -3 -58 25 -23 61 -6 61 29 0 33 -30 49\n-58 29z"/>\n<path d="M2245 1993 c-77 -6 -76 -5 -59 -65 16 -55 61 -146 92 -186 l18 -23\n103 122 c57 67 104 129 105 138 1 14 -14 16 -104 17 -58 0 -127 -1 -155 -3z"/>\n<path d="M3165 1981 c-44 -4 -61 -10 -63 -22 -3 -16 210 -229 228 -229 22 0\n86 141 105 228 l7 32 -109 -2 c-59 -1 -135 -4 -168 -7z"/>\n<path d="M2776 1914 c-19 -18 -19 -20 -6 -45 6 -11 21 -19 35 -19 20 0 45 24\n45 44 0 10 -32 36 -45 36 -7 0 -21 -7 -29 -16z"/>\n<path d="M2589 1743 c-86 -90 -139 -151 -139 -162 0 -25 179 -101 236 -101\nl27 0 -7 143 c-9 166 -13 187 -35 187 -9 0 -46 -30 -82 -67z"/>\n<path d="M2936 1801 c-6 -10 -24 -168 -29 -258 -3 -60 -2 -63 19 -63 79 0 262\n68 248 92 -5 7 -53 64 -108 126 -93 105 -117 124 -130 103z"/>\n<path d="M10723 3125 c-318 -58 -597 -266 -743 -555 -223 -441 -98 -996 289\n-1288 112 -84 188 -125 311 -166 274 -91 545 -70 802 61 552 282 735 983 392\n1500 -225 339 -651 521 -1051 448z m385 -315 c348 -98 579 -443 532 -796 -67\n-508 -596 -796 -1055 -574 -239 116 -396 352 -412 620 -20 335 192 640 516\n745 122 40 289 42 419 5z"/>\n<path d="M11017 2568 c3 -90 9 -167 14 -172 13 -14 53 18 155 122 l95 97 -23\n18 c-50 40 -189 97 -235 97 -10 0 -11 -33 -6 -162z"/>\n<path d="M10705 2706 c-50 -16 -133 -58 -163 -82 l-23 -19 121 -107 c67 -60\n128 -108 135 -108 23 0 27 39 20 186 -8 162 -4 157 -90 130z"/>\n<path d="M11307 2354 c-59 -65 -107 -126 -107 -136 0 -11 11 -18 38 -22 44 -7\n278 7 289 17 15 16 -51 183 -94 236 l-19 24 -107 -119z"/>\n<path d="M10362 2413 c-39 -62 -70 -134 -78 -184 l-7 -39 152 0 c86 0 161 5\n172 10 17 10 18 13 5 38 -8 15 -59 71 -114 125 l-99 99 -31 -49z"/>\n<path d="M10888 2359 c-24 -14 -23 -56 2 -69 44 -23 80 29 44 64 -18 19 -23\n19 -46 5z"/>\n<path d="M10851 2187 c-49 -29 -66 -101 -35 -146 9 -13 32 -29 50 -37 29 -12\n39 -12 68 0 99 41 85 180 -19 192 -24 3 -50 -1 -64 -9z"/>\n<path d="M10660 2136 c-19 -23 -8 -61 18 -64 44 -7 67 32 36 62 -19 20 -38 20\n-54 2z"/>\n<path d="M11096 2124 c-9 -8 -16 -22 -16 -29 0 -13 26 -45 36 -45 20 0 44 25\n44 45 0 14 -8 29 -19 35 -25 13 -27 13 -45 -6z"/>\n<path d="M10335 1991 c-60 -6 -60 -6 -57 -36 9 -69 104 -248 122 -229 57 61\n210 250 207 258 -4 12 -176 17 -272 7z"/>\n<path d="M11267 1983 c-68 -5 -79 -19 -47 -60 23 -31 200 -193 210 -193 3 0\n20 24 37 53 29 48 52 111 67 180 l6 27 -107 -2 c-60 -1 -134 -3 -166 -5z"/>\n<path d="M10870 1910 c-16 -31 4 -62 38 -58 21 2 28 9 30 32 5 45 -47 65 -68\n26z"/>\n<path d="M10651 1703 c-56 -59 -101 -113 -101 -120 0 -28 172 -103 237 -103\nl26 0 -7 123 c-10 179 -15 207 -36 207 -10 0 -63 -48 -119 -107z"/>\n<path d="M11035 1801 c-7 -12 -23 -144 -29 -243 -4 -77 -4 -78 19 -78 45 0\n130 22 193 51 l64 29 -19 23 c-65 82 -198 227 -209 227 -7 0 -15 -4 -19 -9z"/>\n</g>\n</svg>\n`)(t)}\n      </div>\n    `)}}class M extends h{constructor(t){super({...t,viewConstructor:x})}}class G extends a{constructor(t){super({...t,root:".cars-list__item"})}render(t){const{car:{name:e,color:s},selectHandler:n,removeHandler:r,accelerateHandler:a,breakHandler:i}=t;return super.render(`\n      <li class="cars-list__item car">\n        ${this.renderChild("overlay",h,{viewConstructor:D})}\n        <div class="car__winner">\n          <span class="car__winner-title">\n            <i class="fa-solid fa-trophy"></i>\n            Winner!\n          </span>\n          <span class="car__finish-time"></span>\n        </div>\n        <div class="car__header">\n          ${I.call(this,"car",{select:{handler:n},remove:{handler:r,content:'<i class="fa-solid fa-trash-can"></i>',classes:"button_negative"}})}\n          <div class="car__title">${e}</div>\n        </div>\n        <div class="car__body">\n          <div class="car__controls">\n            ${I.call(this,"car",{accelerate:{handler:a,content:"A"},break:{handler:i,content:"B",classes:"button_negative"}})}\n          </div>\n          <div class="car__track">\n            ${this.renderChild("carImg",M,{viewOptions:{data:s}})}\n          </div>\n        </div>\n      </li>\n    `)}}class H extends S{constructor(t){super({...t,viewConstructor:G}),this.handleSelect=()=>{this.emit(v.SELECT_CAR,{car:this.car})},this.handleRemove=()=>{this.showOverlay(),this.disableBtns(),this.emit(v.TRY_REMOVE_CAR,{id:this.car.id,onRemove:t=>{null!==t&&(this.hideOverlay(),this.enableBtns())}})},this.handleAccelerate=()=>{const{id:t}=this.car;this.emit(v.ACCELERATE_CAR,{id:t})},this.handleBreak=()=>{const{id:t}=this.car;this.showOverlay(),this.emit(v.BREAK_CAR,{id:t,onComplete:t=>{this.hideOverlay()}})},this.setButtons=t=>{this.buttons.select[t](),this.buttons.remove[t]()},this.handleStartRace=()=>{this.setButtons("disable")},this.handleEndRace=()=>{this.setButtons("enable")};const{data:e}=t;if(void 0===e)throw new TypeError;this.car=e.car,this.carImg=null,this.buttons={},this.on(v.START_RACE,this.handleStartRace),this.on(v.RACE_END,this.handleEndRace)}afterRender(){super.afterRender();const t=this.getComponent("carImg");!Array.isArray(t)&&t instanceof M&&(this.carImg=t),["select","remove","accelerate","break"].forEach((t=>{const e=this.getComponent(t);!Array.isArray(e)&&e instanceof b&&(this.buttons[t]=e)})),this.buttons.break.disable()}render(){const{car:t,handleSelect:e,handleRemove:s,handleAccelerate:n,handleBreak:r}=this;return super.render({car:t,selectHandler:e,removeHandler:s,accelerateHandler:n,breakHandler:r})}disableBtns(){Object.keys(this.buttons).forEach((t=>this.buttons[t].disable()))}enableBtns(){Object.keys(this.buttons).forEach((t=>this.buttons[t].enable()))}handleFinish(t){this.getRoot().classList.add("car_finisher"),e(this.getRoot())(".car__finish-time").textContent=`${t} s.`}handleWin(t){this.getRoot().classList.add("car_winner"),e(this.getRoot())(".car__finish-time").textContent=`${t} s.`}reset(){this.getRoot().classList.remove("car_winner"),this.getRoot().classList.remove("car_finisher"),this.buttons.accelerate.enable(),this.buttons.break.disable(),null!==this.carImg&&this.carImg.getRoot().classList.remove("car-img_broken")}}class W extends o{constructor(t){super({...t,root:".garage-race"})}renderCars(t){return`<ul class="garage__cars-list cars-list">${t.map((t=>this.renderChild("cars",H,{data:{car:t}}))).join("")}</ul>`}renderPage(t){const{garagePageNumber:e,cars:s,carsAmount:n}=t,r=k.bind(this,e,n,"garage");return`\n      <h2 class="garage-race__title page-title">\n        Garage<span class="garage-race__cars-amount">(${n})</span>\n      </h2>\n      ${r()}\n      <div class="garage-race__tracks">\n        ${this.renderChild("overlay",h,{viewConstructor:D})}\n        <div class="garage-race__tracks-flag"></div>\n        ${this.renderCars(s)}\n      </div>\n      ${r()}\n    `}render(t){let e="";if(void 0!==t){const{error:s}=t;e=s?"Load error":this.renderPage(t)}return super.render((t=>`\n      <div class="garage-race">\n        ${""!==t?t:e}\n      </div>\n    `))}}class z extends S{constructor(t){super({...t,viewConstructor:W}),this.handleAppLoad=t=>{this.onLoadingEnd(t.detail)},this.handleChangePage=()=>{this.showOverlay()},this.cars=[],this.onLoadingStart(),this.on(v.LOAD_APP,this.handleAppLoad),this.on(v.GARAGE_CHANGE_PAGE,this.handleChangePage)}afterRender(){super.afterRender();const t=this.getComponent("cars")||[];this.cars=Array.isArray(t)?t:[t],this.emit(v.CARS_AFTER_RENDER,{carItems:this.cars})}}class U extends a{constructor(t){super({...t,root:".garage"})}render(){return super.render(`\n      <div class="garage">\n        <div class="garage__container container">\n          ${this.renderChild("controlPanel",O)}\n          ${this.renderChild("garageRace",z)}\n        </div>\n      </div>\n    `)}}class B extends h{constructor(t){super({...t,viewConstructor:U})}}class V extends o{constructor(t){super({...t,root:".winners__content"})}renderSortHeader(t,e,s){const{sort:n,sortHandler:r}=s,a=null!==n&&n.type===t?n.order:"default",i=`${e} <span class="winners-table__sort-mark">${"default"!==a?"ASC"===a?'<i class="fa-solid fa-arrow-down"></i>':'<i class="fa-solid fa-arrow-up"></i>':""}</span>`;return`\n      <th\n        class="winners-table__sort-header"\n        data-sort-type="${t}"\n        data-sort-order="${a}">\n        ${I.call(this,"winners-table",{sort:{handler:r,content:i,classes:"button_sort"}})}\n      </th>`}renderTable(t){const{winners:e,carsData:s,winnersPageNumber:n}=t,r=(n-1)*C.WINNERS,a=e.map(((t,e)=>{const{id:n,time:a,wins:i}=t,{name:o,color:c}=s[n],h=this.renderChild("carImg",M,{viewOptions:{data:c}});return`<tr>\n        <td>${r+e+1}</td>\n        <td>${h}</td>\n        <td>${o}</td>\n        <td>${i}</td>\n        <td>${a}</td>\n      </tr>`})).join("");return`\n      <table class="winners-table">\n        <tr>\n          <th>#</th>\n          <th>Image</th>\n          <th>Model</th>\n          ${this.renderSortHeader("wins","Wins",t)}\n          ${this.renderSortHeader("time","Best time (s)",t)}\n        </tr>\n        ${a}\n      </table>\n    `}render(t){let e="";if(void 0!==t){const{error:s,winnersPageNumber:n,winnersAmount:r}=t,a=k.bind(this,n,r,"winners");e=s?"Load error":`${a()}\n          <div class="winners__table-container">\n            ${this.renderChild("overlay",h,{viewConstructor:D})}\n            ${this.renderTable(t)}\n          </div>\n          ${a()}`}return super.render((t=>`\n      <div class="winners__content">\n        ${""!==t?t:e}\n      </div>\n    `))}}class j extends S{constructor(t){super({...t,viewConstructor:V}),this.handleLoadWinners=t=>{this.onLoadingEnd({...t.detail,error:null,sortHandler:this.handleSort})},this.handleSort=t=>{const e=t.target;if(null===e||!(e instanceof HTMLElement))return;const s=e.closest(".winners-table__sort-header");if(null===s)return;const n=s.getAttribute("data-sort-type");let r=s.getAttribute("data-sort-order");null!==n&&null!==r&&(r="default"===r?"ASC":"ASC"===r?"DESC":"ASC",this.emit(v.GET_WINNERS,{type:n,order:r}),this.handleChangePage())},this.handleChangePage=()=>{this.showOverlay()},this.onLoadingStart(),this.emit(v.GET_WINNERS),this.on(v.LOAD_WINNERS,this.handleLoadWinners),this.on(v.WINNERS_CHANGE_PAGE,this.handleChangePage)}afterRender(){super.afterRender()}}class F extends a{constructor(t){super({...t,root:".winners"})}render(){return super.render(`\n      <div class="winners">\n        <div class="winners__container container">\n          <h2 class="winners__title page-title">Winners</h2>\n          ${this.renderChild("winnersTable",j)}\n        </div>\n      </div>\n    `)}}class Y extends h{constructor(t){super({...t,viewConstructor:F})}}class K extends a{render(){return super.render(`\n      ${this.renderChild("alert",f)}\n      ${this.renderChild("header",h,{viewConstructor:p})}\n      <main class="main">\n        ${this.renderChild("router",A,{viewOptions:{root:".main"},data:{routes:{"#":["garagePage",B],"#winners":["winnersPage",Y]}}})}\n      </main>\n      ${this.renderChild("footer",h,{viewConstructor:d})}\n    `)}}var X,J;!function(t){t.STARTED="started",t.STOPPED="stopped",t.DRIVE="drive",t.BROKEN="broken"}(X||(X={}));class q{constructor(t,e,s){this.animate=()=>{const t=Date.now()-this.prevTime;this.driveTime+=t,this.currDistance+=t*this.velocity,this.currDistance>this.distance&&(this.currDistance=this.distance),this.updateTransform(),this.prevTime=Date.now(),(0===this.serverDriveTime||this.driveTime<this.serverDriveTime)&&!this.isHandBreak?requestAnimationFrame(this.animate):this.handleAnimationEnd()},this.startEngine=t=>{const{buttons:e}=this.carListItem;e.accelerate.disable();const s=this.carListItem.carImg?.getRoot();this.status=X.STARTED;const n=s?.parentElement;if(!n)return;const{velocity:r,distance:a}=t;this.time=Number.parseFloat((a/r/1e3).toFixed(3));const i=s.getBoundingClientRect(),{width:o}=n.getBoundingClientRect();this.distance=o-i.width;const c=Math.round(a/r);this.velocity=this.distance/c},this.startDrive=(t=0)=>{const{buttons:e}=this.carListItem;e.break.enable(),this.delay=t,this.isOnRace=!0,this.status=X.DRIVE,this.prevTime=Date.now(),this.animate()},this.handleEngineBroke=()=>{this.status=X.BROKEN},this.break=()=>{this.status=X.STOPPED},this.startCarEngine=async(t,e)=>{const s=await r(this.carEngineService.switchEngine(t,X.STARTED));s instanceof Error?e(s):e(null,s)},this.tryStartEngine=async()=>(this.reset(),new Promise(((t,e)=>{const{id:s}=this.carListItem.car;this.startCarEngine(s,((s,n)=>{if(s||!n)return e(s);this.startEngine(n),t(n)}))}))),this.accelerateCar=async(t,e)=>{const s=await r(this.carEngineService.switchDriveMode(t));s instanceof Error?e(s):e(null,s)},this.tryStartDrive=async(t=-1)=>new Promise(((e,s)=>{this.rejectDrivePromise=s;const{id:n}=this.carListItem.car,r=Date.now(),a=this.time||0;this.accelerateCar(n,((i,o={success:!1})=>{if(this.serverDriveTime=Date.now()-r,t>=6&&(this.serverDriveTime-=this.delay),i||!o.success)return this.handleEngineBroke(),s(i||"Car engine broke");this.break(),e({...o,id:n,time:a})}))})),this.carEngineService=e,this._carListItem=t,this.status=X.STOPPED,this.prevTime=0,this.velocity=0,this.distance=0,this.currDistance=0,this.rejectDrivePromise=null,this.isOnRace=!1,this.isWinner=!1,this.time=0,this.serverDriveTime=0,this.driveTime=0,this.delay=0,this.onFinish=s,this.isHandBreak=!1}get carListItem(){return this._carListItem}set carListItem(t){this._carListItem=t,this.updateCarListItem()}updateCarListItem(){this.isOnRace&&(this.carListItem.buttons.break.enable(),this.carListItem.buttons.accelerate.disable()),this.driveTime>=this.serverDriveTime&&this.status===X.STOPPED&&0!==this.time&&(this.isWinner?this.carListItem.handleWin(this.time):this.carListItem.handleFinish(this.time)),this.updateTransform()}updateTransform(){const t=this.carListItem.carImg?.getRoot();void 0!==t&&(this.status===X.BROKEN&&t.classList.add("car-img_broken"),t.style.transform=`translateX(${this.currDistance}px)`)}handleAnimationEnd(){if(this.isHandBreak)return this.reset();if(this.status===X.DRIVE&&(this.status=this.driveTime<this.distance/this.velocity?X.BROKEN:X.STOPPED),this.driveTime>=this.serverDriveTime&&this.status===X.STOPPED){const{id:t}=this.carListItem.car;this.onFinish(t,this.time,(t=>{this.isWinner=t,this.isWinner?this.carListItem.handleWin(this.time):this.carListItem.handleFinish(this.time)}))}else this.updateTransform()}reset(){this.driveTime=0,this.serverDriveTime=0,this.delay=0,this.carListItem.reset(),this.velocity=0,this.distance=0,this.currDistance=0,this.status=X.STOPPED,this.isOnRace=!1,this.isWinner=!1,this.isHandBreak=!1,this.time=0,this.updateTransform()}handleWin(){this.isWinner=!0}}!function(t){t[t.SERVER_ERROR=500]="SERVER_ERROR"}(J||(J={}));class Q extends Error{constructor(t){super(`Http error: ${t.statusText}`),this.status=t.status}}function Z(t){if(!t.ok)throw new Q(t);return t}class tt{async getCars(t){const e=`${tt.URL}?${n(t)}`,s=Z(await fetch(e));return{cars:await s.json(),carsAmount:Number(s.headers.get("X-Total-Count"))}}async getCar(t){return Z(await fetch(`${tt.URL}/${t}`)).json()}async createCar(t){Z(await fetch(tt.URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}))}async deleteCar(t){Z(await fetch(`${tt.URL}/${t}`,{method:"DELETE"}))}async updateCar(t,e){Z(await fetch(`${tt.URL}/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}))}}tt.URL=`${m}/garage`;class et{async switchEngine(t,e){const s=`${et.URL}?${n({id:t,status:e})}`;return Z(await fetch(s,{method:"PATCH"})).json()}async switchDriveMode(t){const e=`${et.URL}?${n({id:t,status:X.DRIVE})}`;try{return Z(await fetch(e,{method:"PATCH"})).json()}catch(t){if(t instanceof Q&&t.status===J.SERVER_ERROR)return{success:!1};throw t}}}et.URL=`${m}/engine`;class st{async getWinners(t){const e=`${st.URL}?${n(t)}`,s=Z(await fetch(e));return{winners:await s.json(),winnersAmount:Number(s.headers.get("X-Total-Count"))}}async getWinner(t){return Z(await fetch(`${st.URL}/${t}`)).json()}async createWinner(t){Z(await fetch(st.URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}))}async deleteWinner(t){Z(await fetch(`${st.URL}/${t}`,{method:"DELETE"}))}async updateWinner(t,e){Z(await fetch(`${st.URL}/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}))}}st.URL=`${m}/winners`;class nt extends EventTarget{constructor(){super()}on(t,e){const s=(t=>e=>{if(!function(t){return"detail"in t}(e))throw new TypeError;t(e)})(e);return this.addEventListener(t,s),()=>{this.removeEventListener(t,s)}}emit(t,e){this.dispatchEvent(new CustomEvent(t,{detail:e}))}}new class extends h{constructor(t){const e=document.createElement("div");e.setAttribute("id","app"),document.body.append(e),super({...t,viewConstructor:K,viewOptions:{root:e}}),this.handleDataLoad=({cars:t,carsAmount:e})=>{this.carsData=t,this.carsAmount=e,this.handleAppLoad(null)},this.loadData=async()=>this.carsService.getCars({_page:this.garagePageNumber,_limit:C.GARAGE}),this.handleAppLoad=async(t=null)=>{const{carsData:e,carsAmount:s,garagePageNumber:n,isRaceInProgress:r,createCarData:a,updateCarData:i,selectedCarId:o}=this;this.emit(v.LOAD_APP,{isRaceInProgress:r,garagePageNumber:n,cars:e,carsAmount:s,error:t,createCarData:a,updateCarData:i,selectedCarId:o})},this.handlePageChange=t=>{const{activePage:e}=t.detail,s=this.getComponent("header");Array.isArray(s)||s.update(e),this.handleAppLoad(null)},this.handleUpdateCarFormData=t=>{const{form:e,data:s}=t.detail;"Create"===e?this.createCarData=s:this.updateCarData=s},this.handleTryCreateCar=async t=>{const{carData:e,onComplete:s}=t.detail,n=await r(this.carsService.createCar(e));this.handleDataLoad(await this.loadData()),s(n instanceof Error?n:null)},this.handleTryUpdateCar=async t=>{const{carData:e,onComplete:s}=t.detail;if(null===this.selectedCarId)return s(null);const n=await r(this.carsService.updateCar(this.selectedCarId,e));this.handleDataLoad(await this.loadData()),s(n instanceof Error?n:null),this.selectedCarId=null},this.handleSelectCar=t=>{this.selectedCarId=t.detail.car.id},this.handleTryRemoveCar=async t=>{const{id:e,onRemove:s}=t.detail;e===this.selectedCarId&&(this.selectedCarId=null);const n=await r(this.carsService.deleteCar(e));await r(this.winnersService.deleteWinner(e)),this.handleDataLoad(await this.loadData()),s(n instanceof Error?n:null)},this.handleCarsAfterRender=t=>{const{carItems:e}=t.detail;0!==e.length&&(this.cars.length===e.length&&e.every((({car:t},e)=>t.id===this.cars[e].carListItem.car.id))?this.cars.forEach(((t,s)=>{t.carListItem=e[s]})):this.cars=e.map((t=>new q(t,this.carEngineService,this.handleFinishRace))))},this.handleStartRace=async()=>{this.isWinnerFinished=!1,this.isRaceInProgress=!0;let t={success:!0},e=[],s=0,n=0;try{await Promise.all(this.cars.map((t=>t.tryStartEngine()))),e=this.cars.map(((t,e)=>t.tryStartDrive(e))),s=Date.now(),Promise.allSettled(e).then((t=>{setTimeout((()=>{this.emit(v.RACE_END,t),this.isRaceInProgress=!1}),n)})),e.length>6&&(t=await Promise.race(e))}catch(e){t.success=!1}finally{n=e.length>6?Date.now()-s:0,this.cars.forEach((t=>t.startDrive(n)))}},this.handleFinishRace=async(t,e,s)=>{if(this.isWinnerFinished||!this.isRaceInProgress)return s(!1);if(this.isWinnerFinished=!0,s(!0),void 0===t||void 0===e)return;let n=await r(this.winnersService.getWinner(t));if(n instanceof Error)r(this.winnersService.createWinner({id:t,wins:1,time:e}));else if(null!==n){const s=e<n.time?e:n.time,a=n.wins+1;r(this.winnersService.updateWinner(t,{wins:a,time:s}))}},this.handleResetCars=async t=>{const{onComplete:e}=t.detail,s=this.cars.map((t=>r(this.carEngineService.switchEngine(t.carListItem.car.id,X.STOPPED))));try{await Promise.all(s),e(null)}catch(t){t instanceof Error&&e(t)}finally{this.cars.forEach((t=>{t.reset()}))}},this.handleCarAccelerate=async t=>{const{id:e}=t.detail,s=this.cars.find((t=>t.carListItem.car.id===e));if(s)try{await s.tryStartEngine(),s.startDrive(),await s.tryStartDrive()}catch(t){s.handleEngineBroke()}},this.handleCarBreak=async t=>{const{id:e,onComplete:s}=t.detail,n=this.cars.find((t=>t.carListItem.car.id===e));if(n)try{n.isHandBreak=!0,await r(this.carEngineService.switchEngine(e,X.STOPPED)),s(null)}catch(t){t instanceof Error&&s(t)}finally{n.rejectDrivePromise?.("Manual break"),n.rejectDrivePromise=null,n.status!==X.STOPPED&&n.status!==X.BROKEN||n.reset()}},this.handleGarageChangePage=async t=>{const{pageNumber:e}=t.detail;this.garagePageNumber=e,this.handleDataLoad(await this.loadData())},this.handleWinnersChangePage=async t=>{const{pageNumber:e}=t.detail;this.winnersPageNumber=e,this.handleLoadWinners()},this.handleGenerateCars=async t=>{const{onComplete:e}=t.detail,s=Array.from({length:100},((t,e)=>{const s=Math.floor(Math.random()*_.length),n=Math.floor(Math.random()*E.length);return r(this.carsService.createCar({name:`${_[s]} ${E[n]}`,color:`#${Math.floor(16777215*Math.random()).toString(16)}`}))}));try{await Promise.allSettled(s),this.handleDataLoad(await this.loadData()),e(null)}catch(t){t instanceof Error&&e(t)}},this.handleLoadWinners=async t=>{t?.detail&&(this.sort=t.detail);const e=null!==this.sort?{_sort:this.sort.type,_order:this.sort.order}:{};try{const t=await this.winnersService.getWinners({_page:this.winnersPageNumber,_limit:C.WINNERS,...e}),{isRaceInProgress:s,winnersPageNumber:n}=this,r=(await Promise.all(t.winners.map((({id:t})=>this.carsService.getCar(t))))).reduce(((t,e)=>{const{id:s,name:n,color:r}=e;return{...t,[s]:{name:n,color:r}}}),{});this.emit(v.LOAD_WINNERS,{...t,sort:this.sort,carsData:r,isRaceInProgress:s,winnersPageNumber:n})}catch(t){this.emit(v.LOAD_WINNERS,{error:t})}},this.cars=[],this.carsData=[],this.carsAmount=0,this.carsService=new tt,this.winnersService=new st,this.carEngineService=new et,this.garagePageNumber=1,this.winnersPageNumber=1,this.sort=null,this.selectedCarId=null,this.isRaceInProgress=!1,this.isWinnerFinished=!1,this.createCarData=g,this.updateCarData=g,this.on(v.ROUTER_CHANGE_PAGE,this.handlePageChange),this.on(v.CARS_AFTER_RENDER,this.handleCarsAfterRender),this.on(v.TRY_CREATE_CAR,this.handleTryCreateCar),this.on(v.TRY_UPDATE_CAR,this.handleTryUpdateCar),this.on(v.SELECT_CAR,this.handleSelectCar),this.on(v.TRY_REMOVE_CAR,this.handleTryRemoveCar),this.on(v.ACCELERATE_CAR,this.handleCarAccelerate),this.on(v.BREAK_CAR,this.handleCarBreak),this.on(v.GET_WINNERS,this.handleLoadWinners),this.on(v.WINNERS_CHANGE_PAGE,this.handleWinnersChangePage),this.on(v.UPDATE_CAR_FORM_DATA,this.handleUpdateCarFormData),this.on(v.START_RACE,this.handleStartRace),this.on(v.RESET_CARS,this.handleResetCars),this.on(v.GARAGE_CHANGE_PAGE,this.handleGarageChangePage),this.on(v.GENERATE_CARS,this.handleGenerateCars),this.loadData().then(this.handleDataLoad).catch((t=>{this.emit(v.SHOW_ALERT,`Error loading data: ${t.message}`),this.handleAppLoad(t)})),this.getRoot().insertAdjacentHTML("beforeend",this.render()),this.afterRender()}}({emmiter:new nt})})();